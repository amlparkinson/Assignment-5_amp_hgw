---
title: "Pacific giant salamanders in Mack Creek"
author: "Anne-Marie Parkinson and Hannah Garcia-Wickstrum"
date: "November 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE)
```

```{r}
# load packages ------------------------------------------------------------------

library(tidyverse)
library(janitor)
library(dplyr)
library(kableExtra)
library(ggbeeswarm)
library(car)

# add data -------------------------------------------------------------------------

mack_creek_verts <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()

```


### Introduction
Beginning in 1993, researchers from the [Andrews Experimental Forest Long-Term Ecological Research (LTER)](https://andrewsforest.oregonstate.edu) have been monitoring populations of Pacific Giant Salamanders, *Dicamptodon tenebrosus*, specifically in Mack Creek (Gregory 2016). The Experimental Forest is part of the Willamette National Forest in western Oregon and managed by the U.S. Forest Service and Oregon State University (Figure 2.). Researchers are interested in how disturbances in forests effect biota. The data was collected from two sections of of Mack Creek - a clear cut section and an old-growth section. Here, we will use the data collected by the Andrews Experimental Forest Team to compare the differences in size and weight distributions of salamanders from clear cut and old growth sections. 

![](Dicamptodon tenebrosus.jpg) 
***Figure 1.** A Pacific Giant Salamander (Dicamptodon tenebrosus) laying on a down log. Photo credit: Gary Nafis, [www.californiaherps.com](http://www.californiaherps.com/salamanders/pages/d.tenebrosus.html).*

![](map3.jpg)
***Figure 2.** Map of HJ Andrews Experimental Forest LTER in Oregon. Andrews Experimental Forest is managed by the U.S. Forest Service and Oregon State University.* 

### Data and Methods

Anne-Marie

### Results

#### Results A: Annual salamander counts in old growth and clear cut sections of Mack Creek

Salamander counts in old growth and clear cut sections were compared between 1993 and 2017. Overall, salamander counts in both sections followed similar patterns; when counts in old growth sections were high (>200), counts in clear cut sections were also high. In 1994, 2011, and 2015-2017, salamander counts were higher in clear cut sections than old growth sections. In total, old growth sections had higher populations of salamanders (n = 5,951) compared to clear cut sections (n = 5,051) over the 17 year period.  

```{r}
# subdata: remove unneccessary columns and keep only salamander observations
salamander_counts_data <- mack_creek_verts %>% 
  filter (species == "DITE") %>% 
  select (year, section, species)

# count number of salamanders in each section (CC vs OG) for every year
salamander_counts <- salamander_counts_data %>% 
  group_by(year, section) %>% 
  count(species) %>%
  mutate(section_long = case_when(
    section %in% "CC" ~ "Clear Cut",
    section %in% "OG" ~ "Old Growth"))

# totalling counts of salamanders in CC and OG sections for result descriptions
salamander_counts_totals <- salamander_counts %>%
  group_by(section) %>%
  summarize(total_pop = sum(n))

# Graph of salamander counts
ggplot(salamander_counts, aes(x = year, y = n)) +
  geom_line(aes(color = section_long), size = 1) +
  geom_point(aes(color = section_long), size = 2) +
  scale_x_continuous(lim = c(1993, 2017),
                     expand = c(0, 0),
                     breaks = seq(1993, 2017, by = 2)) +
  scale_color_manual(values = c("orange", "seagreen")) +
  theme_bw() +
  labs(x = "Year",
       y = "Salamander count",
       title = "Salamander Count in Clear Cut and Old Growth Sections")

# I can't figure out how to change the title of the legend!?!?

```
***Figure 3.** Salamander counts in clear cut (orange) and old growth (green) sections of Mack Creek. Old growth sections are responsible for higher counts of salamanders for 80% of the time between 1993 and 2017. The populations in both sections display similar patterns of highs and lows. Data: Stanley Gregory, Andrews Forest LTER Sites.* 

### Results B: Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth and clear cut sections of Mack Creek. 

```{r}
#subdata: only include 2017 and salamader observations, exclude isolated pools from data
salamander_channel_2017 <- mack_creek_verts %>% 
  filter (year == "2017") %>% 
  filter (species == "DITE") %>% 
  filter (unittype != "IP") %>% 
  mutate(channel_type= case_when(
    unittype %in% "C" ~ "Cascade",
    unittype %in% "P" ~"Pool",
    unittype %in% "SC" ~ "Side Channel"
  )) %>% 
  select (species, channel_type, section)

# counts
salamander_channel_counts_2017 <- salamander_channel_2017 %>% 
  group_by(channel_type, section) %>% 
  count(species) %>% 
  select (channel_type, section, n)

# create contigency table 
salamander_table_2017 <- salamander_channel_counts_2017 %>% 
  pivot_wider(names_from = section, values_from = n) 
  

# add proportions to contigency table
salamander_table_counts_proportions_2017 <- salamander_table_2017 %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits=1) %>% 
  adorn_ns(position = "front")

#  markdown ready table
salamander_table_counts_proportions_2017 %>% 
  kable (col.names = c("Channel Type", "Clear Cut Forest", "Old-Growth Forest")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

  
```
***Figure 4.** Counts of salamanders in different channels of clear cut and old-growth forests. NEEDS MORE INFO. Data: Stanley Gregory, Andrews Forest LTER Sites.*

### Results C: Chi-Square test to determine if there is a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two old growth and clear cut forests. 

```{r}

# subdata: remove qualitative column (channel type) and only include counts (not proportions)
salamander_chi_counts <- salamander_table_2017 %>% 
  dplyr::select(-channel_type) 

salamander_chi_counts <- mack_creek_verts %>% 
  filter (year == "2017") %>% 
  filter (species == "DITE") %>% 
  filter (unittype != "IP") %>% 
  select (species, unittype, section) %>% 
  group_by(unittype, section) %>% 
  count(species) %>% 
  select (unittype, section, n) %>% 
  pivot_wider(names_from = section, values_from = n) %>% 
  dplyr::select(-unittype) 

# chi-sqaure test
# chisq.test(salamander_chi_counts)


```
i cannot get rid of the unittype/channel type column for the chi squared subdata!!

### Results D: Is there a significant difference in mean weights for Pacific giant salamanders observed in clear cut vs  old growth forests in 2017

```{r, include = FALSE}
# sub data: only include salamander observations in 2017 and remove unneccessary columns
salamader_weights <- mack_creek_verts %>% 
  filter (species == "DITE") %>% 
  filter (year == "2017") %>% 
  select (section, species, weight)

# look at data spread ------------------------------------------------------------

#histogram --> observations are very skewed towards smaller weights
ggplot (salamader_weights, aes (x=weight)) +
  geom_histogram() +
  facet_wrap(~section)

# qqplot
ggplot (salamader_weights, aes (sample=weight)) +
  geom_qq() +
  facet_wrap(~section)

#conclusion: most of the points in both qq plots follow a straight line, even though there is some deviation in the qqplot and the histograms are skewed, we can assume the means follow a normal sampling distribution because of the central limit theorem so we can use a parametrric test to compare means -- Can you explain how those are normally distributed? They don't look like it at all... (HGW)

# statistical significance test ----------------------------------------------------

weigths_ttest <- t.test(weight~section, data=salamader_weights)

weigths_ttest
```
double check wording of the data spread conclusion to labs we've done with allison

### Results E: Is there a significant difference between mean Pacific giant salamander weights in the 3 channel types: pools, cascades and side-channels of Mack Creek in 2017?

Salamanders found in side channels of Mack Creek had the lowest mean weight (mean~2017~ = 5.68 grams) compared to salamanders found in pools (mean~2017~ = 9.30 grams) and cascades (mean~2017~ = 7.52) (Figure 5.).

```{r}
# Visually compare the salamander weights between the three channel classifications: SC (side channel), P (pool), C (cascade). Use beeswarm or jitter. 

# filter species, years, and channels for just Cascade, Pool, and Side Channel
channel_weights <- mack_creek_verts %>%
  filter(species == "DITE") %>%
  filter(year == 2017) %>%
  filter(unittype %in% c("C", "P", "SC")) %>%
  mutate(channel_type = case_when(
    unittype %in% "C" ~ "Cascade",
    unittype %in% "P" ~"Pool",
    unittype %in% "SC" ~ "Side Channel"))

# Calculate the mean, standard deviation, standard error, and variance
channel_weights_mean <- channel_weights %>%
  select(unittype, weight, channel_type) %>%
  group_by(channel_type) %>%
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE),
            sample_size = n(),
            se_weight = sd((weight) / sqrt(n()), na.rm = TRUE),
            var_weight = var(weight, na.rm = TRUE))

# Graph the salamander weights for all channels for 2017
ggplot() +
  ggbeeswarm::geom_beeswarm(data = channel_weights,
                            aes(x = channel_type,
                                y = weight,
                                color = unittype),
                            na.rm = TRUE,
                            size = 2,
                            alpha = 0.6,
                            pch = 16,
                            show.legend = FALSE) +
  geom_errorbar(data = channel_weights_mean,
                aes(x = channel_type,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                color = "black",
                width = 0.1) +
  geom_point(data = channel_weights_mean,
             aes(x = channel_type, y = mean_weight),
             color = "black",
             size = 4) +
  labs(x = "Channel Type",
       y = "Weight (grams)") +
  ggtitle("2017 Salamander Weight in Different Channels")
              
# Is it ok to have negative error bar??
```
***Figure 5.** Weights of salamanders in cascade, pool, and side channels of Mack Creek. Mean weights for each channel type are indicated by the black, center dot. Standard error of weights are indicated by the upper and lower bars. Data: Stanley Gregory, Andrews Forest LTER Sites.*

```{r}
# Is there a significant difference in mean weight for pacific giant salamanders observed in pools vs cascades vs side channels in 2017? 

  ## Null Hypothesis: the mean weight for different channel types are the same/not significantly different.
  ## Alternative Hypothesis: the mean weight for differnt channel types are not the same/are significantly different. 

salamander_aov <- aov(weight ~ channel_type, data = channel_weights)
summary(salamander_aov)

# Describe any concerns you have about comparing means across the groups... 
```


### Summary

- finding 1
- finding 2
- finding 3

### References 

**Gregory S. V. 2016**. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/25/2019.
