---
title: "Pacific giant salamanders in Mack Creek"
author: "Anne-Marie Parkinson and Hannah Garcia-Wickstrum"
date: "November 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE)
```

```{r}
# load packages ------------------------------------------------------------------

library (tidyverse)
library (janitor)
library (dplyr)
library (kableExtra)

# add data -------------------------------------------------------------------------

mack_creek_verts <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()

```


### Introduction

url for picture: http://www.californiaherps.com/salamanders/pages/d.tenebrosus.html
photo credit: Gary Nafis
### Data and Methods

### Results

#### Results A: Annual salamander counts in old growth and clear cut sections of Mack Creek

```{r}
# subdata: remove unneccessary columns and keep only salamander observations
salamander_counts_data <- mack_creek_verts %>% 
  filter (species == "DITE") %>% 
  select (year, section, species)

# count number of salamanders in each section (CC vs OG) for every year
salamander_counts <- salamander_counts_data %>% 
  group_by(year, section) %>% 
  count(species)

# plot - not the right graph type
# ggplot(salamander_counts, aes (x=year, y=n)) +
#   geom_col(aes(fill=section)) 

ggplot(salamander_counts, aes(fill = section, x = year, y = n)) +
  geom_bar(position = "dodge", stat = "identity") +
  scale_fill_manual("legend", values = c("CC" = "orange", "OG" = "seagreen")) +
  scale_x_continuous(lim = c(1993, 2017),
                     expand = c(0, 0),
                     breaks = seq(1993, 2017, by = 2)) +
  labs(x = "year", y = "salamander counts") +
  ggtitle("Salamander counts in old growth and clear cut sections")

# ggplot(salamander_counts, aes(x = year, y = n)) +
#   geom_line(aes(color = section), size = 1) +
#   geom_point(aes(color = section), size = 2) +
#   scale_x_continuous(lim = c(1993, 2017),
#                      expand = c(0, 0),
#                      breaks = seq(1993, 2017, by = 2)) +
#   theme_bw()  

  
# what do you think about the grouped bar? and the colors? do you think we should have the legend list out the full name instead of the acronym? or we can just clearly state in title and figure caption? I don't really like the line graph..What do you think?
```
***Figure #.** Salamander counts in clear cut (orange) and old growth (green) sections of Mack Creek. From 1993 to 2013, there were almost always more salamanders counted in old growth sections. From 2013 to 2017, salamander counts were higher in clear cut sections. Data: Stanley Gregory, Andrews Forest LTER Sites.* **Needs editing and better description.**

### Results B: Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth and clear cut sections of Mack Creek. 

```{r}
#subdata: only include 2017 and salamader observations, exclude isolated pools from data
salamander_channel_2017 <- mack_creek_verts %>% 
  filter (year == "2017") %>% 
  filter (species == "DITE") %>% 
  filter (unittype != "IP") %>% 
  mutate(channel_type= case_when(
    unittype %in% "C" ~ "Cascade",
    unittype %in% "P" ~"Pool",
    unittype %in% "SC" ~ "Side Channel"
  )) %>% 
  select (species, channel_type, section)

# counts
salamander_channel_counts_2017 <- salamander_channel_2017 %>% 
  group_by(channel_type, section) %>% 
  count(species) %>% 
  select (channel_type, section, n)

# create contigency table 
salamander_table_2017 <- salamander_channel_counts_2017 %>% 
  pivot_wider(names_from = section, values_from = n) 
  

# add proportions to contigency table
salamander_table_counts_proportions_2017 <- salamander_table_2017 %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits=1) %>% 
  adorn_ns(position = "front")

#  markdown ready table
salamander_table_counts_proportions_2017 %>% 
  kable (col.names = c("Channel Type", "Clear Cut Forest", "Old-Growth Forest")) %>% 
  kable_styling()

  
```
not sure why getting that error message. its not affecting the table counts/proportions (ex/when change position from front to rear dont get the error message)

### Results C: Chi-Square test to determine if there is a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two old growth and clear cut forests. 

```{r}

# subdata: remove qualitative column (channel type) and only include counts (not proportions)
salamander_chi_counts <- salamander_table_2017 %>% 
  dplyr::select(-channel_type) 

salamander_chi_counts <- mack_creek_verts %>% 
  filter (year == "2017") %>% 
  filter (species == "DITE") %>% 
  filter (unittype != "IP") %>% 
  select (species, unittype, section) %>% 
  group_by(unittype, section) %>% 
  count(species) %>% 
  select (unittype, section, n) %>% 
  pivot_wider(names_from = section, values_from = n) %>% 
  dplyr::select(-unittype) 

# chi-sqaure test
#chisq.test(salamander_chi_counts)


```
i cannot get rid of the unittype/channel type column for the chi squared subdata!!

### Results D: Is there a significant difference in mean weights for Pacific giant salamanders observed in clear cut vs  old growth forests in 2017

```{r}
# sub data: only include salamander observations in 2017 and remove unneccessary columns
salamader_weights <- mack_creek_verts %>% 
  filter (species == "DITE") %>% 
  filter (year == "2017") %>% 
  select (section, species, weight)

# look at data spread ------------------------------------------------------------

#histogram --> observations are very skewed towards smaller weights
ggplot (salamader_weights, aes (x=weight)) +
  geom_histogram() +
  facet_wrap(~section)

# qqplot
ggplot (salamader_weights, aes (sample=weight)) +
  geom_qq() +
  facet_wrap(~section)

#conclusion: most of the points in both qq plots follow a straight line, even though there is some deviation in the qqplot and the histograms are skewed, we can assume the means follow a normal sampling distribution because of the central limit theorem so we can use a parametrric test to compare means -- Can you explain how those are normally distributed? They don't look like it at all... (HGW)

# statistical significance test ----------------------------------------------------

weigths_ttest <- t.test(weight~section, data=salamader_weights)

weigths_ttest
```
double check wording of the data spread conclusion to labs we've done with allison

### Results E: Is there a significant difference between mean Pacific giant salamander weights in the 3 channel types: pools, cascades and side-channels of Mack Creek in 2017

```{r}
# Visually compare the salamander weights between the three channel classifications: SC (side channel), P (pool), C (cascade). unittype Beeswarm

channel_weights <- mack_creek_verts %>%
  filter(species == "DITE") %>%
  filter(unittype %in% c("C", "P", "SC")) %>%
  mutate(channel_type = case_when(
    unittype %in% "C" ~ "Cascade",
    unittype %in% "P" ~"Pool",
    unittype %in% "SC" ~ "Side Channel"))

channel_weights_mean <- channel_weights %>%
  select(unittype, weight, channel_type) %>%
  group_by(channel_type) %>%
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE),
            sample_size = n(),
            se_weight = sd(weight) / sqrt(n()),
            var_weight = var(weight))

# having issues with these damn NA values!!! >:(
  

# ggplot() +
#   ggbeeswarm::geom_beeswarm(data = channel_weights,
#                             aes(x = channel_type,
#                                 y = weight,
#                                 color = unittype),
#                             na.rm = TRUE,
#                             size = 2,
#                             alpha = 0.6,
#                             pch = 16)
# #   facet_wrap(~unittype, scales = "free")

ggplot(data = channel_weights, 
       aes(x = channel_type,
           y = weight)) +
  geom_jitter(aes(color = channel_type),
              alpha = 0.6,
              show.legend = FALSE) +
  scale_y_continuous(lim = c(0, 140),
                     expand = c(0, 0),
                     breaks = seq(0, 135, by = 15)) +
  theme_bw() +
  labs(x = "channel type", y = "weight (grams)") +
  ggtitle("Weights of Salamanders in Different Channel Types") +
  geom_errorbar(data = channel_weights_mean,
                aes(x = channel_type,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                    inherit.aes = FALSE,
                color = "black",
                width = 0.1)
  

# My graphs keep turning out really weird... I'm not sure what else there is to do. 
  
```


### Summary

### References 

**Gregory S. V. 2016**. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/25/2019.
